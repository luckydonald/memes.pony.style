(function(f,b){"function"===typeof define&&define.amd?define(["exports","backbone","underscore"],b):"undefined"!==typeof exports?b(exports,require("backbone"),require("underscore")):b(f,f.Backbone,f._)})(this,function(f,b,e){b.Tastypie={apiKey:{username:"",key:""},constructSetUrl:function(a){return"set/"+a.join(";")+"/"},csrfToken:"",defaultOptions:{},doGetOnEmptyPostResponse:!0,doGetOnEmptyPutResponse:!1,idAttribute:"resource_uri"};b.Model.prototype.idAttribute=b.Tastypie.idAttribute;b.oldSync=b.sync;
b.sync=function(a,d,c){var h={};c=e.defaults(c||{},b.Tastypie.defaultOptions);b.Tastypie.apiKey&&b.Tastypie.apiKey.username&&(h.Authorization="ApiKey "+b.Tastypie.apiKey.username+":"+b.Tastypie.apiKey.key);b.Tastypie.csrfToken&&(h["X-CSRFToken"]=b.Tastypie.csrfToken);h=e.extend(h,c.headers);c.headers=h;if("create"===a&&b.Tastypie.doGetOnEmptyPostResponse||"update"===a&&b.Tastypie.doGetOnEmptyPutResponse){var g=new $.Deferred,f=c.success;g.done(function(a,b,c){e.isFunction(f)&&f(a)});c.success=function(a,
f,l){if(a||201!==l.status&&202!==l.status&&204!==l.status)return g.resolveWith(c.context||c,[a,f,l]);c=e.defaults({url:l.getResponseHeader("Location")||d.url(),headers:h,success:g.resolve,error:g.reject},b.Tastypie.defaultOptions);return b.ajax(c)};var k=c.error;g.fail(function(a,b,c){e.isFunction(k)&&k(a.responseText)});c.error=function(a,b,d){g.rejectWith(c.context||c,[a,b,a.responseText])};g.request=b.oldSync(a,d,c);return g}return b.oldSync(a,d,c)};b.Model.prototype.url=function(){var a=this.get("resource_uri");
a||(a=e.result(this,"urlRoot")||this.collection&&e.result(this.collection,"url"))&&this.has("id")&&(a=k(a)+this.get("id"));return(a=a&&k(a))||null};b.Model.prototype.parse=function(a){return a&&a.objects&&(e.isArray(a.objects)?a.objects[0]:a.objects)||a};b.Collection.prototype.parse=function(a){a&&a.meta&&(this.meta=a.meta);return a&&a.objects||a};b.Collection.prototype.url=function(a){var d=e.result(this,"urlRoot");d||(d=(d=this.models.length&&this.models[0])&&e.result(d,"urlRoot"));d||(d=e.result(this.model.prototype,
"urlRoot"));d=d&&k(d);a&&a.length&&(a=e.map(a,function(a){a=a instanceof b.Model?a.url():a;a=e.compact(a.split("/"));return a[a.length-1]}),d+=b.Tastypie.constructSetUrl(a));return d||null};var k=function(a){return a+(0<a.length&&"/"===a.charAt(a.length-1)?"":"/")}});
